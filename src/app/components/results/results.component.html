<div class="min-h-screen bg-[#fafafa]" *ngIf="recommendation">

  <header class="bg-white border-b border-neutral-200">
    <div class="max-w-3xl mx-auto px-4 py-3 flex items-center justify-between">
      <a [routerLink]="['/']" class="text-base font-semibold text-neutral-800 hover:text-neutral-600">FytAI</a>
      <span class="text-sm text-neutral-500">{{ 'RESULTS.COMPATIBILITY_SCORE' | translate }}: {{ recommendation.score }}%</span>
    </div>
  </header>

  <main class="max-w-3xl mx-auto px-4 py-6" id="results-container">

    <div class="bg-white border border-neutral-200 rounded-lg p-6 mb-5 text-center">
      <h1 class="text-xl font-semibold text-neutral-900 mb-2">
        {{ recommendation.sport }}
      </h1>
      <div class="inline-flex items-center gap-2 px-3 py-1.5 bg-blue-50 text-blue-700 rounded-full text-sm font-medium mb-3">
        {{ recommendation.score }}% {{ 'RESULTS.COMPATIBILITY_SCORE' | translate | lowercase }}
      </div>
      <p class="text-neutral-600 text-sm">
        {{ recommendation.reason }}
      </p>
    </div>

    <div class="bg-blue-50 border border-blue-200 rounded-lg p-5 mb-5">
      <h3 class="text-base font-medium text-blue-900 mb-3 flex items-center gap-2">
        <lucide-icon [img]="Target" class="w-5 h-5"></lucide-icon>
        {{ 'RESULTS.QUICK_ACTIONS' | translate }}
      </h3>
      <div class="flex items-center gap-2 mb-3">
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <a [href]="getGoogleMapsSearch()"
           target="_blank"
           rel="noopener noreferrer"
           class="flex items-center gap-3 p-3 bg-white rounded-md hover:shadow-md transition-shadow cursor-pointer">
          <lucide-icon [img]="MapPin" class="w-5 h-5 text-blue-600 shrink-0"></lucide-icon>
          <div>
            <p class="text-sm font-medium text-gray-900">{{ 'RESULTS.FIND_CLUB' | translate }}</p>
            <p class="text-xs text-gray-500">{{ 'RESULTS.NEAR_ME' | translate }}</p>
          </div>
        </a>

        <a [href]="getYouTubeSearch()"
           target="_blank"
           rel="noopener noreferrer"
           class="flex items-center gap-3 p-3 bg-white rounded-md hover:shadow-md transition-shadow cursor-pointer">
          <lucide-icon [img]="Youtube" class="w-5 h-5 text-red-600 shrink-0"></lucide-icon>
          <div>
            <p class="text-sm font-medium text-gray-900">{{ 'RESULTS.VIDEO_TUTORIALS' | translate }}</p>
            <p class="text-xs text-gray-500">{{ 'RESULTS.FOR_BEGINNERS' | translate }}</p>
          </div>
        </a>

        <a [href]="getEquipmentSearch()"
           target="_blank"
           rel="noopener noreferrer"
           class="flex items-center gap-3 p-3 bg-white rounded-md hover:shadow-md transition-shadow cursor-pointer">
          <lucide-icon [img]="ShoppingBag" class="w-5 h-5 text-green-600 shrink-0"></lucide-icon>
          <div>
            <p class="text-sm font-medium text-gray-900">{{ 'RESULTS.EQUIPMENT' | translate }}</p>
            <p class="text-xs text-gray-500">{{ 'RESULTS.ESTIMATED_BUDGET' | translate }}</p>
          </div>
        </a>
      </div>
    </div>

    <div *ngIf="recommendation.alternatives && recommendation.alternatives.length > 0" class="mb-5">
      <button
        (click)="toggleComparison()"
        class="w-full text-sm text-blue-600 hover:text-blue-700 hover:underline cursor-pointer">
        {{ showComparison ? ('COMPARISON.HIDE' | translate) : ('COMPARISON.SHOW' | translate) }} →
      </button>
    </div>

    <div *ngIf="showComparison && recommendation.alternatives && recommendation.alternatives.length > 0" class="mb-5">
      <app-sport-comparison
        [alternatives]="recommendation.alternatives">
      </app-sport-comparison>
    </div>

    <!-- <div *ngIf="recommendation.trainingPlan" class="mb-5">
      <app-training-plan [trainingPlan]="recommendation.trainingPlan"></app-training-plan>
    </div> -->


    <div class="bg-white border border-neutral-200 rounded-lg p-5 mb-5">
      <button (click)="toggleNextSteps()"
              class="w-full flex items-center justify-between cursor-pointer">
        <h2 class="text-base font-medium text-neutral-900">{{ 'RESULTS.WHAT_NOW_TITLE' | translate }}</h2>
        <lucide-icon [img]="ChevronDown" class="w-5 h-5 text-neutral-400 transition-transform" [class.rotate-180]="showNextSteps"></lucide-icon>
      </button>

      <div *ngIf="showNextSteps" class="mt-4 space-y-4">
        <div class="p-4 bg-green-50 border border-green-100 rounded-md">
          <h3 class="text-sm font-medium text-green-800 mb-2">{{ 'RESULTS.WEEK1_TITLE' | translate }}</h3>
          <ul class="space-y-1 text-sm text-green-700">
            <li>• {{ 'RESULTS.WEEK1_STEP1' | translate }}</li>
            <li>• {{ 'RESULTS.WEEK1_STEP2' | translate }}</li>
            <li>• {{ 'RESULTS.WEEK1_STEP3' | translate }}</li>
          </ul>
        </div>

        <div class="p-4 bg-blue-50 border border-blue-100 rounded-md">
          <h3 class="text-sm font-medium text-blue-800 mb-2">{{ 'RESULTS.WEEK2_TITLE' | translate }}</h3>
          <ul class="space-y-1 text-sm text-blue-700">
            <li>• {{ 'RESULTS.WEEK2_STEP1' | translate }}</li>
            <li>• {{ 'RESULTS.WEEK2_STEP2' | translate }}</li>
            <li>• {{ 'RESULTS.WEEK2_STEP3' | translate }}</li>
          </ul>
        </div>

        <div class="p-4 bg-neutral-50 border border-neutral-200 rounded-md">
          <h3 class="text-sm font-medium text-neutral-800 mb-2">{{ 'RESULTS.WEEK3_TITLE' | translate }}</h3>
          <ul class="space-y-1 text-sm text-neutral-600">
            <li>• {{ 'RESULTS.WEEK3_STEP1' | translate }}</li>
            <li>• {{ 'RESULTS.WEEK3_STEP2' | translate }}</li>
            <li>• {{ 'RESULTS.WEEK3_STEP3' | translate }}</li>
          </ul>
        </div>
      </div>
    </div>


    <div class="bg-amber-50 border border-amber-200 rounded-lg p-4 mb-5">
      <div class="flex gap-3">
        <lucide-icon [img]="warning" class="w-5 h-5 text-amber-600 shrink-0 mt-0.5"></lucide-icon>
        <div>
          <p class="text-sm font-medium text-amber-800 mb-0.5">{{ 'RESULTS.DISCLAIMER_TITLE' | translate }}</p>
          <p class="text-sm text-amber-700">{{ 'RESULTS.DISCLAIMER_TEXT' | translate }}</p>
        </div>
      </div>
    </div>


    <div class="flex flex-col sm:flex-row gap-3 mb-6">
      <button
        (click)="saveResults()"
        [disabled]="isSaved"
        class="flex-1 inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-white bg-green-600 border border-green-600 rounded-md hover:bg-green-700 transition-colors cursor-pointer disabled:bg-green-300 disabled:cursor-not-allowed">
        <lucide-icon [img]="Download" class="w-4 h-4"></lucide-icon>
        {{ isSaved ? ('RESULTS.SAVED' | translate) : ('RESULTS.SAVE' | translate) }}
      </button>
      <button
        (click)="exportToPDF()"
        [disabled]="isExportingPdf"
        class="flex-1 inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-white bg-red-600 border border-red-600 rounded-md hover:bg-red-700 transition-colors cursor-pointer disabled:bg-red-300 disabled:cursor-not-allowed">
        <lucide-icon *ngIf="!isExportingPdf" [img]="FileText" class="w-4 h-4"></lucide-icon>
        <lucide-icon *ngIf="isExportingPdf" [img]="RefreshCw" class="w-4 h-4 animate-spin"></lucide-icon>
        {{ isExportingPdf ? ('RESULTS.EXPORTING' | translate) : ('RESULTS.EXPORT_PDF' | translate) }}
      </button>
      <button
        (click)="shareOnTwitter()"
        class="flex-1 inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-white bg-[#1DA1F2] border border-[#1DA1F2] rounded-md hover:bg-[#1a8cd8] transition-colors cursor-pointer">
        <lucide-icon [img]="Twitter" class="w-4 h-4"></lucide-icon>
        {{ 'RESULTS.SHARE_TWITTER' | translate }}
      </button>
    </div>

    <!-- Feedback Section -->
    <div class="mb-6">
      <app-feedback [recommendation]="recommendation"></app-feedback>
    </div>

    <div class="flex flex-col sm:flex-row gap-3">
      <button
        (click)="backToForm()"
        class="flex-1 inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-neutral-700 bg-white border border-neutral-300 rounded-md hover:bg-neutral-50 transition-colors cursor-pointer">
        {{ 'RESULTS.RETRY_TEST' | translate }}
      </button>
      <button
        (click)="backToHome()"
        class="flex-1 inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors cursor-pointer">
        {{ 'RESULTS.BACK_HOME' | translate }}
      </button>
    </div>
  </main>

  <app-chatbot
    *ngIf="recommendation"
    [recommendation]="recommendation"
    [userProfile]="userProfile!">
  </app-chatbot>
</div>

<div *ngIf="!recommendation" class="min-h-screen bg-[#fafafa] flex items-center justify-center">
  <div class="text-center">
    <div class="animate-spin w-8 h-8 border-2 border-neutral-300 border-t-blue-600 rounded-full mx-auto mb-4"></div>
    <p class="text-sm text-neutral-600">{{ 'RESULTS.REDIRECTING' | translate }}</p>
  </div>
</div>
